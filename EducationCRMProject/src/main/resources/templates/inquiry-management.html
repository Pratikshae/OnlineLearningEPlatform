<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Inquiry Management</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">

<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<link rel="stylesheet" th:href="@{/css/style.css}" />

		<style>
				#plusButton, #customerName, #inquiresTable, #newInquiryButton {
					display: none;
				}
		</style>


</head>
<body>
	<div
		th:replace="~{fragments/employee-sidebar :: frag-employee-sidebar}"></div>

	<div class="main-content">
		<h2>Inquiry Management</h2>
		<p>Here you can search and add new inquiry</p>

		<div th:if="${successMsg}" class="alert alert-success mb-3 mt-5"
			role="alert">
			<!-- print success message here -->
			<span th:text="${successMsg}"></span>
		</div>

		<div th:if="${errorMsg}" class="alert alert-danger mb-3 mt-5"
			role="alert">
			<!-- print error message here -->
			<span th:text="${errorMsg}"></span>
		</div>

		<div class="container my-4" style="background-color: rgb(54, 54, 54);">
			<div class="navbar p-3">
				<div class="d-flex align-items-center">
					<div class="input-group me-2">
						<input type="text" class="form-control" id="searchPhoneNumber"
							placeholder="Search by phone number" />
						<button class="btn btn-outline-secondary" type="button" onclick="searchInquiry()">
							<i class="bi bi-search"></i>
						</button>
					</div>
					<button id="plusButton" class="btn btn-primary me-2"
						data-bs-toggle="modal" data-bs-target="#exampleModal">
						<i class="bi bi-plus"></i>
					</button>
				</div>
				<a href="/newInquiry" id="newInquiryButton"
					class="btn btn-success ms-auto">New Inquiry</a>
			</div>
		</div>

		<div>
			<h4 id="customerName">Customer Name: Pratiksha</h4>
			<table id="inquiresTable"
				class="table table-striped table-hover table-bordered shadow mt-4">
				<thead>
					<tr>
						<th scope="col">Interested Course</th>
						<th scope="col">Discussion</th>
						<th scope="col">Inquiry Type</th>
						<th scope="col">Call Type</th>
						<th scope="col">Status</th>
						<th scope="col">Inquiry Date / Time</th>
					</tr>
				</thead>
				<tbody id="inquiryTableBody">
					
					
				</tbody>
			</table>
		</div>

	</div>
	<!-- Modal -->
	<div class="modal fade" id="exampleModal" tabindex="-1"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Continue
						Inquiry</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<!-- form or content for the old inquiry continuation -->
					<form th:action="@{/submitInquiryForm}" th:object="${inquiry}"
						method="POST">
						<div class="mb-3">
							<label class="form-label">Customer Phone Number:</label> <input
								name="phoneno" type="text"  id="modalCustomerPhno" class="form-control"
								placeholder="Enter customer phone no." required/>
						</div>
						<div class="mb-3">
							<label class="form-label">Customer Name:</label> <input
								name="name" type="text" id="modalCustomerName" class="form-control"
								placeholder="Enter customer name" required/>
						</div>
						<div class="mb-3">
							<label class="form-label">Interested Course:</label> <input
								name="interestedCourse" type="text" class="form-control"
								placeholder="Enter interested Course" required/>
						</div>
						<div class="mb-3">
							<label class="form-label">Discussion:</label>
							<textarea class="form-control" name="discussion" placeholder="Enter discussion" required></textarea>
						</div>
						<div class="mb-3">
							<label class="form-label">Inquiry Type:</label> 
							<select class="form-select" name="inquiryType" required>
								<option value="" disabled>Inquiry Type:</option>
								<option value="Call">Call</option>
								<option value="Mail">Mail</option>
								<option value="Website">Website</option>
								<option value="Social Network">Social Network</option>
								<option value="Friend Reference">Friend Reference</option>
								<option value="Advertisement">Advertisement</option>
								<option value="Other">Other</option>
							</select>
						</div>
						<div class="mb-3">
							<label class="form-label">Call Type:</label> <select
								name="callType" class="form-select" required>
									<option value="" disabled>Call Type:</option>
								<option value="Inbound Call">Inbound Call (customer
									call to company)</option>
								<option value="Outbound Call">Outbound Call (company
									call to customer)</option>
							</select>
						</div>
						<div class="mb-3">
							<label class="form-label">Status:</label> <select
								id="status" onchange="toggleFollowUpdate()" class="form-select" name="status" required>
								<option value="" disabled>Status</option>
								<option value="Interested - (follow up)">Interested -
									(follow up)</option>
								<option value="Interested - (closed)">Interested -
									(closed)</option>
								<option value="Not Interested - (closed)">Not
									Interested - (closed)</option>
								<option value="Purchased - (closed)">Purchased -
									(closed)</option>
								<option value="Others - (closed)">Others - (closed)</option>
							</select>
						</div>
						<div class="mb-3" id="followUpdateDiv">
								<label class="form-label">Follow Up Date:</label> <input
									name ="followUpDate" type="date" class="form-control"
									placeholder="Enter follow up date" />
						</div>
						<button type="submit" class="btn btn-primary">Add inquiry</button>
					</form>
				</div>
			</div>
		</div>
	</div>
	
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
    	
    	function searchInquiry() {
			var searchPhoneNumber = $("#searchPhoneNumber").val();	
			
			
			$.ajax({
					
					url:"/api/searchInquiries",
					type:"GET",
					data: {phoneNumber: searchPhoneNumber},
					success: function(response) {

						$("#inquiryTableBody").empty();
						if(response.length > 0) {
							$.each(response, function(index, inquiry) {
								
								
								
								var row = `<tr>
												<td>${inquiry.interestedCourse}</td>
												<td>${inquiry.discussion}</td>
												<td>${inquiry.inquiryType}</td>
												<td>${inquiry.callType}</td>
												<td>${inquiry.status}</td>
												<td>${inquiry.dateOfInquiry},  ${inquiry.timeOfInquiry}</td>
											</tr>`;
											
								$("#inquiryTableBody").append(row);
							});	
							
							$("#inquiresTable").show();
							$("#plusButton").show();
							
							var customerName = response[0].name;
							$("#customerName").text("Customer Name: " + customerName).show();
							
							$("#newInquiryButton").hide();
							
							$("#modalCustomerPhno").val(searchPhoneNumber);
							$("#modalCustomerName").val(customerName);
							
						}else {
							//alert("No data found");
							$("#customerName").text("No Customer found").show();
							$("#inquiresTable").hide();
							$("#plusButton").hide();
							
							$("#newInquiryButton").show();
							
							
							$("#modalCustomerPhno").val("");
							$("#modalCustomerName").val("");
						}
					},
					error: function(error) { 
						alert("Error fetching data");
					}
				
			});	
    	}
    	
    	
    	function toggleFollowUpdate() {

			var status = document.getElementById('status').value;
			var followUpdateDiv = document.getElementById('followUpdateDiv');

			if (status === "Interested - (follow up)") {

				followUpdateDiv.style.display = "block";
			} else {

				followUpdateDiv.style.display = "none";
			}
		}
    
    </script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
		crossorigin="anonymous"></script>
</body>
</html>