<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>View Feedback</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
	crossorigin="anonymous" />

<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
<link rel="stylesheet" th:href="@{/css/style.css}">

</head>
<body>
	<div th:replace="~{fragments/admin-sidebar :: frag-admin-sidebar}"></div>

	<div class="main-content">
		<h2>View Customer Feedbacks</h2>
		<p>Here you can view customers feedbacks...</p>

		<section class="mt-5 text-center">
			<h3>Customers Feedbacks List</h3>
		</section>

		<section class="mt-5">
			<div th:if="${#lists.isEmpty(feedbackPage.content)}">
				<div class="alert alert-warning" role="alert">No customer's
					Feedbacks</div>
			</div>

			<div th:if="${!#lists.isEmpty(feedbackPage.content)}">
				<table class="table table-striped table-hover table-bordered shadow">
					<thead>
						<tr>
							<th>Name</th>
							<th>Email</th>
							<th>Feedback</th>
							<th>Read Full Feedback</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="feedback: ${feedbackPage.content}">
							<td th:text="${feedback.userName}"></td>
							<td th:text="${feedback.userEmail}"></td>
							<td th:text="${#strings.abbreviate(feedback.userFeedback, 25)}"></td>
							<td>
								<!-- Button trigger method -->
								<button type="buton" class="btn btn-white"
									data-bs-toggle="modal" data-bs-target="#feedbackModal"
									th:data-feedback-id="${feedback.id}"
									th:data-feedback="${feedback.userFeedback}"
									th:data-feedback-name="${feedback.userName}"
									th:data-feedback-email="${feedback.userEmail}"
									th:data-feedback-date="${feedback.dateOfFeedback}"
									th:data-feedback-time="${feedback.timeOfFeedback}">

									<i th:if="${feedback.readStatus == 'unread'}"
										class="bi bi-envelope-fill icon-unread"></i> <i
										th:if="${feedback.readStatus == 'read'}"
										class="bi bi-envelope-check icon-read"></i>
								</button>
							</td>
						</tr>
					</tbody>
				</table>


				<!-- pagination bar -->
				<nav aria-label="Page navigation">
					<ul class="pagination">
						<li class="page-item"
							th:classappend="${feedbackPage.hasPrevious()} ? '' : 'disabled'">
							<a class="page-link"
							th:href="@{/adminFeedback(page=${feedbackPage.number-1}, size=${feedbackPage.size})}">
								<span aria-hidden="true">&laquo;</span>
						</a>
						</li>

						<li class="page-item"
							th:each="i : ${#numbers.sequence(0, feedbackPage.totalPages-1)}"
							th:classappend="${feedbackPage.number==i} ? 'active' : ''">
							<a class="page-link"
							th:href="@{/adminFeedback(page=${i} ,size=${feedbackPage.size})}"
							th:text="${i+1}"></a>
						</li>

						<li class="page-item"
							th:classappend="${feedbackPage.hasNext()} ? '' : 'disabled'">
							<a class="page-link"
							th:href="@{/adminFeedback(page=${feedbackPage.number+1} ,size=${feedbackPage.size})}">
								<span aria-hidden="true">&raquo;</span>
						</a>
						</li>
					</ul>
				</nav>
			</div>
		</section>
	</div>


	<div class="modal fade" id="feedbackModal" tabindex="-1"
		aria-labelledby="feedbackModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="feedbackModalLabel">Feedback
						Details</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>
						<strong>Name:</strong> <span id="modalFeedbackName"></span>
					</p>
					<p>
						<strong>Email:</strong> <span id="modalFeedbackEmail"></span>
					</p>
					<p>
						<strong>Feedback:</strong> <span id="modalFeedbackContent"></span>
					</p>
					<p>
						<strong>Date:</strong> <span id="modalFeedbackDate"></span>
					</p>
					<p>
						<strong>Time:</strong> <span id="modalFeedbackTime"></span>
					</p>
				</div>

				<div class="modal-footer">

					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">Close</button>

					<form id="markReadForm" method="post"
						action="/updateFeedbackStatus">
						<input type="hidden" name="id" id="feedbackId" /> <input
							type="hidden" name="status" value="read" />
						<button type="submit" class="btn btn-primary">Mark Read</button>
					</form>

					<form id="markUnreadForm" method="post"
						action="/updateFeedbackStatus">
						<input type="hidden" name="id" id="feedbackIdUnread" /> <input
							type="hidden" name="status" value="unread" />
						<button type="submit" class="btn btn-danger">Mark Unread</button>
					</form>
				</div>
			</div>
		</div>
	</div>

	<link rel="stylesheet"
		href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
		integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD"
		crossorigin="anonymous">

	<script>
		document
				.addEventListener(
						'DOMContentLoaded',
						function() {
							var feedabackModal = document
									.getElementById('feedbackModal');
							var feedbackIdField = document
									.getElementById('feedbackId');
							var feedbackIdFieldUnRead = document
									.getElementById('feedbackIdUnread');

							feedbackModal
									.addEventListener(
											'show.bs.modal',
											function(event) {
												var button = event.relatedTarget;
												var feedbackId = button
														.getAttribute('data-feedback-id');
												var feedback = button
														.getAttribute('data-feedback');
												var name = button
														.getAttribute('data-feedback-name');
												var email = button
														.getAttribute('data-feedback-email');
												var date = button
														.getAttribute('data-feedback-date');
												var time = button
														.getAttribute('data-feedback-time');

												document
														.getElementById('modalFeedbackName').textContent = name;
												document
														.getElementById('modalFeedbackEmail').textContent = email;
												document
														.getElementById('modalFeedbackContent').textContent = feedback;
												document
														.getElementById('modalFeedbackDate').textContent = date;
												document
														.getElementById('modalFeedbackTime').textContent = time;

												feedbackIdField.value = feedbackId;
												feedbackIdFieldUnRead.value = feedbackId;
											});

						});
	</script>
</body>
</html>
